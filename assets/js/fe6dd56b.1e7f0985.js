"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[5959],{27108:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>s,contentTitle:()=>o,default:()=>I,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"CS/ProgrammingLanguage/java/\u96ea\u82b1\u7b97\u6cd5-java","title":"\u96ea\u82b1\u7b97\u6cd5","description":"~~~","source":"@site/docs/CS/ProgrammingLanguage/java/\u96ea\u82b1\u7b97\u6cd5-java.md","sourceDirName":"CS/ProgrammingLanguage/java","slug":"/CS/ProgrammingLanguage/java/\u96ea\u82b1\u7b97\u6cd5-java","permalink":"/docs/CS/ProgrammingLanguage/java/\u96ea\u82b1\u7b97\u6cd5-java","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CS/ProgrammingLanguage/java/\u96ea\u82b1\u7b97\u6cd5-java.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"tsid-creator","permalink":"/docs/CS/ProgrammingLanguage/java/tsId\u5de5\u5177\u5e93"},"next":{"title":"CPP/ C++","permalink":"/docs/CS/ProgrammingLanguage/cpp/"}}');var a=t(74848),r=t(28453);const l={},o="\u96ea\u82b1\u7b97\u6cd5",s={},d=[];function c(n){const e={code:"code",h1:"h1",header:"header",pre:"pre",...(0,r.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"\u96ea\u82b1\u7b97\u6cd5",children:"\u96ea\u82b1\u7b97\u6cd5"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:'\n\nimport java.time.LocalDateTime;\nimport java.util.Date;\n\n/**\n * \u96ea\u82b1\u7b97\u6cd5Id\u751f\u6210\n */\npublic class IdGenerater {\n\n\n    /**\n     * \u83b7\u53d6id\n     * @return id\n     */\n    public String getIdAsString() {\n        return String.valueOf(SnowFlakeUtil.getSnowFlakeId());\n    }\n    /**\n     * \u83b7\u53d6id\n     * @return id\n     */\n    public Long getId() {\n        return SnowFlakeUtil.getSnowFlakeId();\n    }\n\n\n\n    private static class SnowFlakeUtil {\n\n        private static final SnowFlakeUtil snowFlakeUtil;\n\n        static {\n            snowFlakeUtil = new SnowFlakeUtil();\n        }\n\n        // \u521d\u59cb\u65f6\u95f4\u6233(\u7eaa\u5e74)\uff0c\u53ef\u7528\u96ea\u82b1\u7b97\u6cd5\u670d\u52a1\u4e0a\u7ebf\u65f6\u95f4\u6233\u7684\u503c\n        // 1650789964886\uff1a2022-04-24 16:45:59\n        private static final long INIT_EPOCH = 1650789964886L;\n\n        // \u65f6\u95f4\u4f4d\u53d6&\n        private static final long TIME_BIT =\n                0b1111111111111111111111111111111111111111110000000000000000000000L;\n\n        // \u8bb0\u5f55\u6700\u540e\u4f7f\u7528\u7684\u6beb\u79d2\u65f6\u95f4\u6233\uff0c\u4e3b\u8981\u7528\u4e8e\u5224\u65ad\u662f\u5426\u540c\u4e00\u6beb\u79d2\uff0c\u4ee5\u53ca\u7528\u4e8e\u670d\u52a1\u5668\u65f6\u949f\u56de\u62e8\u5224\u65ad\n        private long lastTimeMillis = -1L;\n\n        // dataCenterId\u5360\u7528\u7684\u4f4d\u6570\n        private static final long DATA_CENTER_ID_BITS = 5L;\n\n        // dataCenterId\u5360\u75285\u4e2a\u6bd4\u7279\u4f4d\uff0c\u6700\u5927\u503c31\n        // 0000000000000000000000000000000000000000000000000000000000011111\n        private static final long MAX_DATA_CENTER_ID = ~(-1L << DATA_CENTER_ID_BITS);\n\n        // dataCenterId\n        private final long dataCenterId;\n\n        // workId\u5360\u7528\u7684\u4f4d\u6570\n        private static final long WORKER_ID_BITS = 5L;\n\n        // workId\u5360\u75285\u4e2a\u6bd4\u7279\u4f4d\uff0c\u6700\u5927\u503c31\n        // 0000000000000000000000000000000000000000000000000000000000011111\n        private static final long MAX_WORKER_ID = ~(-1L << WORKER_ID_BITS);\n\n        // workId\n        private final long workerId;\n\n        // \u6700\u540e12\u4f4d\uff0c\u4ee3\u8868\u6bcf\u6beb\u79d2\u5185\u53ef\u4ea7\u751f\u6700\u5927\u5e8f\u5217\u53f7\uff0c\u5373 2^12 - 1 = 4095\n        private static final long SEQUENCE_BITS = 12L;\n\n        // \u63a9\u7801\uff08\u6700\u4f4e12\u4f4d\u4e3a1\uff0c\u9ad8\u4f4d\u90fd\u4e3a0\uff09\uff0c\u4e3b\u8981\u7528\u4e8e\u4e0e\u81ea\u589e\u540e\u7684\u5e8f\u5217\u53f7\u8fdb\u884c\u4f4d\u4e0e\uff0c\u5982\u679c\u503c\u4e3a0\uff0c\u5219\u4ee3\u8868\u81ea\u589e\u540e\u7684\u5e8f\u5217\u53f7\u8d85\u8fc7\u4e864095\n        // 0000000000000000000000000000000000000000000000000000111111111111\n        private static final long SEQUENCE_MASK = ~(-1L << SEQUENCE_BITS);\n\n        // \u540c\u4e00\u6beb\u79d2\u5185\u7684\u6700\u65b0\u5e8f\u53f7\uff0c\u6700\u5927\u503c\u53ef\u4e3a 2^12 - 1 = 4095\n        private long sequence;\n\n        // workId\u4f4d\u9700\u8981\u5de6\u79fb\u7684\u4f4d\u6570 12\n        private static final long WORK_ID_SHIFT = SEQUENCE_BITS;\n\n        // dataCenterId\u4f4d\u9700\u8981\u5de6\u79fb\u7684\u4f4d\u6570 12+5\n        private static final long DATA_CENTER_ID_SHIFT = SEQUENCE_BITS + WORKER_ID_BITS;\n\n        // \u65f6\u95f4\u6233\u9700\u8981\u5de6\u79fb\u7684\u4f4d\u6570 12+5+5\n        private static final long TIMESTAMP_SHIFT =\n                SEQUENCE_BITS + WORKER_ID_BITS + DATA_CENTER_ID_BITS;\n\n        /** \u65e0\u53c2\u6784\u9020 */\n        public SnowFlakeUtil() {\n            this(1, 1);\n        }\n\n        /**\n         * \u6709\u53c2\u6784\u9020\n         *\n         * @param dataCenterId \u6570\u636e\u4e2d\u5fc3ID\n         * @param workerId \u673a\u5668Id\n         */\n        public SnowFlakeUtil(long dataCenterId, long workerId) {\n            // \u68c0\u67e5dataCenterId\u7684\u5408\u6cd5\u503c\n            if (dataCenterId < 0 || dataCenterId > MAX_DATA_CENTER_ID) {\n                throw new IllegalArgumentException(\n                        String.format("dataCenterId \u503c\u5fc5\u987b\u5927\u4e8e 0 \u5e76\u4e14\u5c0f\u4e8e %d", MAX_DATA_CENTER_ID));\n            }\n            // \u68c0\u67e5workId\u7684\u5408\u6cd5\u503c\n            if (workerId < 0 || workerId > MAX_WORKER_ID) {\n                throw new IllegalArgumentException(String.format("workId \u503c\u5fc5\u987b\u5927\u4e8e 0 \u5e76\u4e14\u5c0f\u4e8e %d", MAX_WORKER_ID));\n            }\n            this.workerId = workerId;\n            this.dataCenterId = dataCenterId;\n        }\n\n        /**\n         * \u83b7\u53d6\u552f\u4e00ID\n         *\n         * @return\n         */\n        public static Long getSnowFlakeId() {\n            return snowFlakeUtil.nextId();\n        }\n\n        /**\n         * \u901a\u8fc7\u96ea\u82b1\u7b97\u6cd5\u751f\u6210\u4e0b\u4e00\u4e2aid\uff0c\u6ce8\u610f\u8fd9\u91cc\u4f7f\u7528synchronized\u540c\u6b65\n         *\n         * @return \u552f\u4e00id\n         */\n        public synchronized long nextId() {\n            long currentTimeMillis = System.currentTimeMillis();\n            // \u5f53\u524d\u65f6\u95f4\u5c0f\u4e8e\u4e0a\u4e00\u6b21\u751f\u6210id\u4f7f\u7528\u7684\u65f6\u95f4\uff0c\u53ef\u80fd\u51fa\u73b0\u670d\u52a1\u5668\u65f6\u949f\u56de\u62e8\u95ee\u9898\n            if (currentTimeMillis < lastTimeMillis) {\n                throw new RuntimeException(\n                        String.format(\n                                "\u53ef\u80fd\u51fa\u73b0\u670d\u52a1\u5668\u65f6\u949f\u56de\u62e8\u95ee\u9898\uff0c\u8bf7\u68c0\u67e5\u670d\u52a1\u5668\u65f6\u95f4\u3002\u5f53\u524d\u670d\u52a1\u5668\u65f6\u95f4\u6233\uff1a%d\uff0c\u4e0a\u4e00\u6b21\u4f7f\u7528\u65f6\u95f4\u6233\uff1a%d",\n                                currentTimeMillis, lastTimeMillis));\n            }\n            if (currentTimeMillis == lastTimeMillis) {\n                // \u8fd8\u662f\u5728\u540c\u4e00\u6beb\u79d2\u5185\uff0c\u5219\u5c06\u5e8f\u5217\u53f7\u9012\u589e1\uff0c\u5e8f\u5217\u53f7\u6700\u5927\u503c\u4e3a4095\n                // \u5e8f\u5217\u53f7\u7684\u6700\u5927\u503c\u662f4095\uff0c\u4f7f\u7528\u63a9\u7801\uff08\u6700\u4f4e12\u4f4d\u4e3a1\uff0c\u9ad8\u4f4d\u90fd\u4e3a0\uff09\u8fdb\u884c\u4f4d\u4e0e\u8fd0\u884c\u540e\u5982\u679c\u503c\u4e3a0\uff0c\u5219\u81ea\u589e\u540e\u7684\u5e8f\u5217\u53f7\u8d85\u8fc7\u4e864095\n                // \u90a3\u4e48\u5c31\u4f7f\u7528\u65b0\u7684\u65f6\u95f4\u6233\n                sequence = (sequence + 1) & SEQUENCE_MASK;\n                if (sequence == 0) {\n                    currentTimeMillis = getNextMillis(lastTimeMillis);\n                }\n            } else { // \u4e0d\u5728\u540c\u4e00\u6beb\u79d2\u5185\uff0c\u5219\u5e8f\u5217\u53f7\u91cd\u65b0\u4ece0\u5f00\u59cb\uff0c\u5e8f\u5217\u53f7\u6700\u5927\u503c\u4e3a4095\n                sequence = 0;\n            }\n            // \u8bb0\u5f55\u6700\u540e\u4e00\u6b21\u4f7f\u7528\u7684\u6beb\u79d2\u65f6\u95f4\u6233\n            lastTimeMillis = currentTimeMillis;\n            // \u6838\u5fc3\u7b97\u6cd5\uff0c\u5c06\u4e0d\u540c\u90e8\u5206\u7684\u6570\u503c\u79fb\u52a8\u5230\u6307\u5b9a\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u8fdb\u884c\u6216\u8fd0\u884c\n            // <<\uff1a\u5de6\u79fb\u8fd0\u7b97\u7b26, 1 << 2 \u5373\u5c06\u4e8c\u8fdb\u5236\u7684 1 \u6269\u5927 2^2 \u500d\n            // |\uff1a\u4f4d\u6216\u8fd0\u7b97\u7b26, \u662f\u628a\u67d0\u4e24\u4e2a\u6570\u4e2d, \u53ea\u8981\u5176\u4e2d\u4e00\u4e2a\u7684\u67d0\u4e00\u4f4d\u4e3a1, \u5219\u7ed3\u679c\u7684\u8be5\u4f4d\u5c31\u4e3a1\n            // \u4f18\u5148\u7ea7\uff1a<< > |\n            return\n                    // \u65f6\u95f4\u6233\u90e8\u5206\n                    ((currentTimeMillis - INIT_EPOCH) << TIMESTAMP_SHIFT)\n                            // \u6570\u636e\u4e2d\u5fc3\u90e8\u5206\n                            | (dataCenterId << DATA_CENTER_ID_SHIFT)\n                            // \u673a\u5668\u8868\u793a\u90e8\u5206\n                            | (workerId << WORK_ID_SHIFT)\n                            // \u5e8f\u5217\u53f7\u90e8\u5206\n                            | sequence;\n        }\n\n        /**\n         * \u83b7\u53d6\u6307\u5b9a\u65f6\u95f4\u6233\u7684\u63a5\u4e0b\u6765\u7684\u65f6\u95f4\u6233\uff0c\u4e5f\u53ef\u4ee5\u8bf4\u662f\u4e0b\u4e00\u6beb\u79d2\n         *\n         * @param lastTimeMillis \u6307\u5b9a\u6beb\u79d2\u65f6\u95f4\u6233\n         * @return \u65f6\u95f4\u6233\n         */\n        private long getNextMillis(long lastTimeMillis) {\n            long currentTimeMillis = System.currentTimeMillis();\n            while (currentTimeMillis <= lastTimeMillis) {\n                currentTimeMillis = System.currentTimeMillis();\n            }\n            return currentTimeMillis;\n        }\n\n        /**\n         * \u83b7\u53d6\u968f\u673a\u5b57\u7b26\u4e32,length=13\n         *\n         * @return\n         */\n        public static String getRandomStr() {\n            return Long.toString(getSnowFlakeId(), Character.MAX_RADIX);\n        }\n\n        /**\n         * \u4eceID\u4e2d\u83b7\u53d6\u65f6\u95f4\n         *\n         * @param id \u7531\u6b64\u7c7b\u751f\u6210\u7684ID\n         * @return\n         */\n        public static Date getTimeBySnowFlakeId(long id) {\n            return new Date(((TIME_BIT & id) >> 22) + INIT_EPOCH);\n        }\n\n        //        public static void main(String[] args) {\n        //            SnowFlakeUtil snowFlakeUtil = new SnowFlakeUtil();\n        //            long id = snowFlakeUtil.nextId();\n        //            System.out.println(id);\n        //            Date date = SnowFlakeUtil.getTimeBySnowFlakeId(id);\n        //            System.out.println(date);\n        //            long time = date.getTime();\n        //            System.out.println(time);\n        //            System.out.println(getRandomStr());\n        //\n        //        }\n\n    }\n\n\n}\n\n\n'})})]})}function I(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(c,{...n})}):c(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>l,x:()=>o});var i=t(96540);const a={},r=i.createContext(a);function l(n){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:l(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);